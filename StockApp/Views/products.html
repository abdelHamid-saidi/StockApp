<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="SAIDI Abdelhamid">
    <title>StockApp</title>
    <!-- Favicon -->
    <link rel="shortcut icon" href="assets/img/brand/favicon.png" type="image/x-icon">
    <!-- Icons -->
    <link rel="stylesheet" href="assets/vendor/nucleo/css/nucleo.css" type="text/css">
    <link rel="stylesheet" href="assets/vendor/@fortawesome/fontawesome-free/css/all.min.css" type="text/css">
    <!-- Page plugins -->
    <!-- Argon CSS -->
    <link rel="stylesheet" href="assets/css/argon.css?v=1.2.0" type="text/css">
  </head>

  <body>
    <!-- Sidenav -->
    <nav class="sidenav navbar navbar-vertical  fixed-left  navbar-expand-xs navbar-light bg-white" id="sidenav-main">
    </nav>


    <!-- Main content -->
    <div class="main-content" id="panel">
      <!-- Topnav -->
      <nav class="navbar navbar-top navbar-expand navbar-dark bg-primary border-bottom">
        <div class="container-fluid">
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <!-- Search form -->
            <form class="navbar-search navbar-search-light form-inline mr-sm-3" id="navbar-search-main">
              <div class="form-group mb-0">
                <div class="input-group input-group-alternative input-group-merge">
                  <div class="input-group-prepend">
                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                  </div>
                  <input class="form-control" placeholder="Search" type="text">
                </div>
              </div>
              <button type="button" class="close" data-action="search-close" data-target="#navbar-search-main"
                aria-label="Close">
                <span aria-hidden="true">×</span>
              </button>
            </form>
            <!-- Navbar links -->
            <ul class="navbar-nav align-items-center  ml-md-auto ">
              <li class="nav-item dropdown">
                <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                  aria-expanded="false">
                  <div class="media align-items-center">
                    <span class="avatar avatar-sm rounded-circle"
                      style="background-color: #f8f9fe; display: flex;justify-content: center;align-items: center;">
                      <!-- <img alt="Image placeholder" src="assets/img/theme/team-4.jpg"> -->
                      <span id="lettre" style="color: #0D92F4; font-size: 22px; font-weight: bold;">H</span>
                    </span>
                    <div class="media-body  ml-2  d-none d-lg-block">
                      <span class="mb-0 text-sm  font-weight-bold UserName"></span>
                    </div>
                  </div>
                </a>
                <div class="dropdown-menu  dropdown-menu-right ">
                  <div class="dropdown-header noti-title">
                    <h6 class="text-overflow m-0">Welcome!</h6>
                  </div>
                  <a href="profile.html" class="dropdown-item">
                    <i class="ni ni-single-02"></i>
                    <span>My profile</span>
                  </a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item logout">
                    <i class="ni ni-user-run"></i>
                    <span>Logout</span>
                  </a>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- Header -->
      <!-- Header -->
      <div class="header bg-primary pb-6">
        <div class="container-fluid">
          <div class="header-body">
            <div class="row align-items-center py-4">
              <div class="col-lg-6 col-7">
                <h6 class="h2 text-white d-inline-block mb-0">Products</h6>
              </div>
              <div class="col-lg-6 col-5 text-right">
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-sm btn-neutral" id="manage-categories" data-toggle="modal"
                  data-target="#manageCategoriesModal" style="display: none;">
                  <i class="ni ni-archive-2 text-primary"></i>
                  <span>Categories</span>
                </button>
                <button type="button" class="btn btn-sm btn-neutral" id="add-product" data-toggle="modal"
                  data-target="#exampleModalCenter" style="display: none;">
                  New
                </button>
                <a href="#" class="btn btn-sm btn-neutral">Filters</a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Page content -->
      <div class="container-fluid mt--6">
        <div class="row">
          <div class="col">
            <div class="card">
              <!-- Card header -->
              <div class="card-header border-0">
                <h3 class="mb-0">Products table</h3>
              </div>
              <!-- Light table -->
              <div class="table-responsive">
                <table class="table align-items-center table-flush">
                  <thead class="thead-light">
                    <tr>
                      <th scope="col" class="sort" data-sort="product">product</th>
                      <th scope="col" class="sort" data-sort="price">price</th>
                      <th scope="col" class="sort" data-sort="categories">category</th>
                      <th scope="col" class="sort" data-sort="quantity">quantity</th>
                      <th scope="col" class="sort" data-sort="statut">statut</th>
                      <th scope="col"></th>
                    </tr>
                  </thead>
                  <tbody class="product_list">

                  </tbody>
                </table>
              </div>
              <!-- Card footer -->
              <div class="card-footer py-4">
                <nav aria-label="...">
                  <ul class="pagination justify-content-end mb-0" id="pagination-container">
                    <li class="page-item disabled">
                      <a class="page-link" href="#" tabindex="-1">
                        <i class="fas fa-angle-left"></i>
                        <span class="sr-only">Previous</span>
                      </a>
                    </li>
                    <li class="page-item active">
                      <a class="page-link" href="#">1</a>
                    </li>
                    <li class="page-item">
                      <a class="page-link" href="#">2 <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                      <a class="page-link" href="#">
                        <i class="fas fa-angle-right"></i>
                        <span class="sr-only">Next</span>
                      </a>
                    </li>
                  </ul>
                </nav>
              </div>
            </div>
          </div>
        </div>
        <!-- Footer -->
        <footer class="py-5" id="footer-main">
          <div class="container">
            <div class="row align-items-center justify-content-center">
              <div class="col-xl-6  text-center">
                <div class="copyright text-center">
                  &copy; 2020 <a href="https://saidi-abdelhamid.com/" class="font-weight-bold ml-1"
                    target="_blank">Saidi Abdelhamid</a>
                </div>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>
    <!-- Argon Scripts -->
    <!-- Core -->
    <script src="./assets/vendor/jquery/dist/jquery.min.js"></script>
    <script src="./assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="./assets/vendor/js-cookie/js.cookie.js"></script>
    <script src="./assets/vendor/jquery.scrollbar/jquery.scrollbar.min.js"></script>
    <script src="./assets/vendor/jquery-scroll-lock/dist/jquery-scrollLock.min.js"></script>
    <!-- Argon JS -->
    <script src="./assets/js/argon.js?v=1.2.0"></script>

    <script>
      let pageSize = 10; // Nombre d'éléments par page
      let user = null;

      window.onload = function () {


        // Fonction utilitaire pour créer une option
        let createOption = function (value, text) {
          let option = document.createElement("option");
          option.value = value;
          option.innerText = text;
          return option;
        }

        let loadPage = async function (currentPage) {
          console.log("loadPage " + currentPage);

          let totalPages = await ProductHelper.getTotalPages(pageSize);
          let products = await ProductHelper.getProducts(currentPage, pageSize);

          let paginationContainer = document.getElementById("pagination-container");
          paginationContainer.innerHTML = ""; // Vider le conteneur de pagination

          let productTableBody = document.querySelector(".product_list");
          productTableBody.innerText = '';

          if (products.length === 0) {
            if (currentPage > 1) {
              await loadPage(currentPage - 1);
            }
            return;
          }

          // Ajouter le bouton "Previous"
          let prevButton = document.createElement("li");
          prevButton.className = `page-item ${currentPage === 1 ? "disabled" : ""}`;
          prevButton.innerHTML = `
          <p class="page-link">
            <i class="fas fa-angle-left"></i>
            <span class="sr-only">Previous</span>
          </p>`;
          prevButton.addEventListener("click", async () => {
            if (currentPage > 1) await loadPage(currentPage - 1);
          });
          paginationContainer.appendChild(prevButton);

          // Ajouter les numéros de page
          for (let i = 1; i <= totalPages; i++) {
            const pageItem = document.createElement("li");
            pageItem.className = `page-item ${i === currentPage ? "active" : ""}`;
            pageItem.innerHTML = `<p class="page-link">${i}</p>`;
            pageItem.addEventListener("click", async () => await loadPage(i));
            paginationContainer.appendChild(pageItem);
          }

          // Ajouter le bouton "Next"
          let nextButton = document.createElement("li");
          nextButton.className = `page-item ${currentPage === totalPages ? "disabled" : ""}`;
          nextButton.innerHTML = `
          <p class="page-link">
            <i class="fas fa-angle-right"></i>
            <span class="sr-only">Next</span>
          </p>`;
          nextButton.addEventListener("click", async () => {
            if (currentPage < totalPages) await loadPage(currentPage + 1);
          });
          paginationContainer.appendChild(nextButton);

          products.forEach(product => {
            let row = `
            <tr>
              <th scope="row">
                <div class="media align-items-center">
                  <div class="media-body">
                    <span class="name mb-0 text-sm">${product.name}</span>
                  </div>
                </div>
              </th>
              <td class="budget">
                $${product.price.toFixed(2)} USD
              </td>
              <td>
                ${product.sousCategory.category.name}
              </td>
              <td>
                ${product.unit}
              </td>
              <td>
                <span class="badge badge-dot mr-4">
                  <i class="bg-success"></i>
                  <span class="status">Disponible</span>
                </span>
              </td>
              <td class="text-right">
                <div class="dropdown">
                  <a class="btn btn-sm btn-icon-only text-light" href="#" role="button" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-ellipsis-v"></i>
                  </a>
                  <div class="dropdown-menu dropdown-menu-right dropdown-menu-arrow" id="dropdown-menu-${product.productId}"> 

                  </div>
                </div>
              </td>
            </tr>
          `;

            // Ajout de la ligne dans le tableau
            productTableBody.insertAdjacentHTML("beforeend", row);

            let dropdown = document.getElementById("dropdown-menu-" + product.productId);

            let see = document.createElement("button");
            see.className = "dropdown-item";
            see.dataset.toggle = "modal";
            see.dataset.target = "#detailsModalCenter";
            see.innerText = "Details";
            see.addEventListener("click", async () => {
              try {
                // Extraire et formater les informations du produit
                const details = ` Nom : ${product.name || "Inconnu"}
  Prix : $${product.price?.toFixed(2) || "0.00"}
  Unité : ${product.unit || "Non spécifié"}
  Quantité : ${product.quantity || "Non spécifiée"}
  Catégorie : ${product.sousCategory?.category?.name || "Inconnue"}
  Sous-catégorie : ${product.sousCategory?.name || "Inconnue"}
        `;

                // Afficher les détails dans une alerte ou un autre composant
                document.querySelector("#detailsModalCenter .modal-body").innerText = details;
              } catch (error) {
                console.error("Erreur lors de l'affichage des détails du produit :", error);
              }
            });
            dropdown.appendChild(see);


            if (user?.userRoles?.some(role => role.name === "Manager")) {


              let edit = document.createElement("button");
              edit.className = "dropdown-item";
              edit.dataset.toggle = "modal";
              edit.dataset.target = "#modifyModalCenter";
              edit.innerText = "Modify";
              edit.addEventListener("click", async () => {
                loadModifyForm(product);
              });
              dropdown.appendChild(edit);

              let del = document.createElement("a");
              del.className = "dropdown-item";
              del.innerText = "Delete";
              del.href = "#";
              del.addEventListener("click", async () => {
                await ProductHelper.deleteProduct(product.productId);
                await loadPage(currentPage);
              });
              dropdown.appendChild(del);
            }

            if (user?.userRoles?.some(role => role.name === "Employee")) {

              let buy = document.createElement("button");
              buy.className = "dropdown-item";
              buy.dataset.toggle = "modal";
              buy.dataset.target = "#BuyModalCenter";
              buy.innerText = "Buy";
              dropdown.appendChild(buy);
              document.getElementById("buy-product").addEventListener("click", async () => {
                await ProductHelper.buyProduct(parseInt(product.productId), product.quantity + parseFloat(document.getElementById("input-buy-quantity").value), parseFloat(document.getElementById("input-buy-price").value));
                await loadPage(currentPage);
                $('#BuyModalCenter').modal('hide');
              });

              let sell = document.createElement("button");
              sell.className = "dropdown-item";
              sell.dataset.toggle = "modal";
              sell.dataset.target = "#SellModalCenter";
              sell.innerText = "Sell";
              dropdown.appendChild(sell);
              document.getElementById("sell-product").addEventListener("click", async () => {
                await ProductHelper.sellProduct(parseInt(product.productId), parseInt(product.quantity - parseFloat(document.getElementById("input-sell-quantity").value)), parseFloat(product.quantity), parseFloat(product.price));

                await loadPage(currentPage);
                $('#SellModalCenter').modal('hide');
              });
            }
          });
        }

        let loadForm = async function () {
          let name = document.getElementById("input-name");
          let price = document.getElementById("input-price");
          let unit = document.getElementById("input-unit");
          let quantity = document.getElementById("input-quantity");
          let category = document.getElementById("input-category");
          let sousCategory = document.getElementById("input-sous-category");

          let categories = await CategoryHelper.getCategories();

          // Ajout d'une option par défaut pour les menus déroulants des catégories et sous-catégories
          sousCategory.appendChild(createOption("", "Sélectionnez une sous-catégorie"));

          // Initialisation du menu des catégories
          categories.forEach((cat, index) => {
            category.appendChild(createOption(cat.categoryId, cat.name));

            // Initialisation du menu des sous-catégories pour la première catégorie
            if (index === 0) {
              cat.sousCategories.forEach(sousCat => {
                sousCategory.appendChild(createOption(sousCat.id, sousCat.name));
              });
            }
          });

          // Gestion du changement de catégorie
          category.addEventListener("change", () => {
            let selectedCategory = categories.find(cat => cat.categoryId == category.value);

            sousCategory.innerHTML = ""; // Réinitialisation des sous-catégories
            sousCategory.appendChild(createOption("", "Sélectionnez une sous-catégorie")); // Option par défaut

            selectedCategory.sousCategories.forEach(sousCat => {
              sousCategory.appendChild(createOption(sousCat.sousCategoryId, sousCat.name));
            });
          });
          document.getElementById("save-product").addEventListener("click", async () => {

            await ProductHelper.addProduct(name.value, parseFloat(price.value), unit.value, parseFloat(quantity.value), parseInt(sousCategory.value));
            await loadPage(1);
            $('#exampleModalCenter').modal('hide');
          });
        }

        let loadModifyForm = async function (product) {

          let name = document.getElementById("input-modify-name");
          let price = document.getElementById("input-modify-price");
          let unit = document.getElementById("input-modify-unit");
          let quantity = document.getElementById("input-modify-quantity");
          let category = document.getElementById("input-modify-category");
          let sousCategory = document.getElementById("input-modify-sous-category");

          name.value = product.name;
          price.value = product.price;
          unit.value = product.unit;
          quantity.value = product.quantity;

          let categories = await CategoryHelper.getCategories();

          // Initialisation du menu des catégories
          let optionP = null;
          let SousOptionP = null;
          category.innerHTML = "";
          sousCategory.innerHTML = "";
          categories.forEach((cat, index) => {
            let option = createOption(cat.categoryId, cat.name);

            category.appendChild(option);
            if (product.sousCategory.category.categoryId === cat.categoryId) {
              optionP = option;
              cat.sousCategories.forEach(sousCat => {
                let SousOption = createOption(sousCat.sousCategoryId, sousCat.name);

                if (product.sousCategory.sousCategoryId === sousCat.sousCategoryId) {
                  SousOptionP = SousOption;
                }
                sousCategory.appendChild(SousOption);
              });
            }
          });
          optionP.selected = true;
          SousOptionP.selected = true;

          // Gestion du changement de catégorie
          category.addEventListener("change", () => {
            let selectedCategory = categories.find(cat => cat.categoryId == category.value);

            sousCategory.innerHTML = ""; // Réinitialisation des sous-catégories
            sousCategory.appendChild(createOption("", "Sélectionnez une sous-catégorie")); // Option par défaut

            selectedCategory.sousCategories.forEach(sousCat => {
              sousCategory.appendChild(createOption(sousCat.sousCategoryId, sousCat.name));
            });
          });

          document.getElementById("update-product").addEventListener("click", async () => {
            console.log(parseFloat(quantity.value));

            await ProductHelper.updateProduct(product.productId, name.value, parseFloat(price.value), unit.value, parseFloat(quantity.value), parseInt(sousCategory.value));
            await loadPage(1);
            $('#modifyModalCenter').modal('hide');
          });
        }


        CefSharp.BindObjectAsync("UserHelper", "ProductHelper", "CategoryHelper").then(async () => {
          user = await UserHelper.getAuth();
          document.querySelector(".UserName").innerText = user.username;
          document.querySelector("#lettre").innerText = user.username.charAt(0).toUpperCase();
          document.querySelector(".UserName").innerText = user.username;
          if (user?.userRoles?.some(role => role.name === "Manager")) {
            document.getElementById("add-product").style.display = "inline-block";
            document.getElementById("manage-categories").style.display = "inline-block";
          }
          loadSideNav(user);

          await loadPage(1); // Charger la première page par défaut
          await loadForm();
          await loadCategories();

          Array.from(document.getElementsByClassName('logout')).forEach((element) => {
            element.addEventListener('click', async (e) => {
              e.preventDefault();
              await UserHelper.logout();
              window.location.href = "login.html";
            });
          });
        });
      }
    </script>

    <!-- New Modal -->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog"
      aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalCenterTitle">Add a new product</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-name">Name</label>
                    <input type="text" id="input-name" class="form-control" placeholder="" value="">
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-price">Price</label>
                    <input type="email" id="input-price" class="form-control" placeholder="">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-quantity">Quantity</label>
                    <input type="text" id="input-quantity" class="form-control" placeholder="" value="">
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-unit">Unit</label>
                    <input type="text" id="input-unit" class="form-control" placeholder="" value="">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-category">Category</label>
                    <select class="form-control" id="input-category"></select>
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-category">Sous category</label>
                    <select class="form-control" id="input-sous-category"></select>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" id="save-product">Save</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="detailsModalCenter" tabindex="-1" role="dialog"
      aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-l modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalCenterTitle">product details</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modifyModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
      aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalCenterTitle">Modify a product</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-modify-name">Name</label>
                    <input type="text" id="input-modify-name" class="form-control" placeholder="" value="">
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-modify-price">Price</label>
                    <input type="email" id="input-modify-price" class="form-control" placeholder="">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-modify-quantity">Quantity</label>
                    <input type="text" id="input-modify-quantity" class="form-control" placeholder="" value="">
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-modify-unit">Unit</label>
                    <input type="text" id="input-modify-unit" class="form-control" placeholder="" value="">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-modify-category">Category</label>
                    <select class="form-control" id="input-modify-category"></select>
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-modify-sous-category">Sous category</label>
                    <select class="form-control" id="input-modify-sous-category"></select>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" id="update-product">Update</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Buy Modal -->
    <div class="modal fade" id="BuyModalCenter" tabindex="-1" role="dialog" aria-labelledby="BuyModalCenterTitle"
      aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="BuyModalCenterTitle">Buy Product</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-buy-quantity">Quantity</label>
                    <input type="text" id="input-buy-quantity" class="form-control" placeholder="" value="">
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-buy-price">Price</label>
                    <input type="text" id="input-buy-price" class="form-control" placeholder="" value="">
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" id="buy-product">Buy</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Sell Modal -->
    <div class="modal fade" id="SellModalCenter" tabindex="-1" role="dialog" aria-labelledby="SellModalCenterTitle"
      aria-hidden="true">
      <div class="modal-dialog modal-l modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="SellModalCenterTitle">Sell Product</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="row">
                <div class="col">
                  <div class="form-group">
                    <label class="form-control-label" for="input-sell-quantity">Quantity</label>
                    <input type="text" id="input-sell-quantity" class="form-control" placeholder="" value="">
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" id="sell-product">Sell</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Manage Categories Modal -->
    <div class="modal fade" id="manageCategoriesModal" tabindex="-1" role="dialog"
      aria-labelledby="manageCategoriesModalTitle" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="manageCategoriesModalTitle">Manage Categories</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-lg-6 mt-3">
                <h5>Categories</h5>
                <div class="input-group mt-3">
                  <input type="text" id="new-category-name" class="form-control" placeholder="New Category Name">
                  <div class="input-group-append">
                    <button class="btn btn-primary" id="add-category">Add</button>
                  </div>
                </div>

                <div class="input-group mt-3" id="category-input-group">
                  <select id="category-list" class="form-control ">
                    <!-- Categories will be dynamically added here -->
                  </select>
                  <div class="input-group-append">
                    <button class="btn btn-danger btn-sm" id="Delete-category">
                      <i class="fas fa-trash-alt" style="margin-left: 20px; margin-right: 20px;"></i>
                    </button>
                  </div>
                </div>

              </div>
              <div class="col-lg-6 mt-3">
                <h5>Sous Categories</h5>
                <div class="input-group mt-3">
                  <input type="text" id="new-sous-category-name" class="form-control"
                    placeholder="New Sous Category Name">
                  <div class="input-group-append">
                    <button class="btn btn-primary" id="add-sous-category">Add</button>
                  </div>
                </div>

                <ul id="sous-category-list" class="list-group  mt-3">
                  <!-- Sous Categories will be dynamically added here -->
                </ul>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

    <script>
      let loadCategories = async function (cat) {
        let categories = await CategoryHelper.getCategories();
        let categoryList = document.getElementById("category-list");
        categoryList.innerHTML = "";

        if (categories.length > 0) {
          document.getElementById("category-input-group").style.display = "flex";
          loadSousCategories(categories[0]);
        } else {
          document.getElementById("category-input-group").style.display = "none";
          document.getElementById("sous-category-list").innerHTML = "";
        }

        categories.forEach(category => {
          let option = document.createElement("option");
          option.innerText = category.name;
          option.value = category.categoryId;
          categoryList.appendChild(option);

          if (cat === category.name) {
            option.selected = true;
            loadSousCategories(category);
          }
        });

        categoryList.addEventListener("change", async () => {
          let selectedCategory = categories.find(cat => cat.categoryId == categoryList.value);
          loadSousCategories(selectedCategory);
        });
      }

      let loadSousCategories = async function (selectedCategory) {

        let sousCategories = selectedCategory.sousCategories;
        let sousCategoryList = document.getElementById("sous-category-list");
        sousCategoryList.innerHTML = "";
        sousCategories.forEach(sousCategory => {
          let li = document.createElement("li");
          li.className = "list-group-item d-flex justify-content-between align-items-center";
          li.innerText = sousCategory.name;
          sousCategoryList.appendChild(li);

          let deleteButton = document.createElement("button");
          deleteButton.className = "btn btn-danger btn-sm";
          deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
          deleteButton.addEventListener("click", async () => {
            await CategoryHelper.deleteSousCategory(sousCategory.sousCategoryId);

            selectedCategory.sousCategories = selectedCategory.sousCategories.filter(sousCat => sousCat.sousCategoryId !== sousCategory.sousCategoryId);

            loadSousCategories(selectedCategory);
          });
          li.appendChild(deleteButton);
        });
      }

      document.getElementById("add-category").addEventListener("click", async () => {
        let categoryName = document.getElementById("new-category-name").value;
        await CategoryHelper.addCategory(categoryName);
        loadCategories(categoryName);
        document.getElementById("new-category-name").value = "";
      });

      document.getElementById("Delete-category").addEventListener("click", async () => {
        let selectedCategoryId = document.getElementById("category-list").value;
        await CategoryHelper.deleteCategory(parseInt(selectedCategoryId));
        if (document.getElementById("category-list").options.length > 0) {
          document.getElementById("category-input-group").style.display = "flex";

          loadCategories(document.getElementById("category-list").options[0].text);
        } else {
          document.getElementById("category-input-group").style.display = "none";
          document.getElementById("sous-category-list").innerHTML = "";
        }
      });

      document.getElementById("add-sous-category").addEventListener("click", async () => {
        let sousCategoryName = document.getElementById("new-sous-category-name").value;
        let selectedCategoryId = document.getElementById("category-list").value;
        let categoryName = document.getElementById("category-list").options[document.getElementById("category-list").selectedIndex].text;

        await CategoryHelper.addSousCategory(parseInt(selectedCategoryId), sousCategoryName);
        loadCategories(categoryName);
        document.getElementById("new-sous-category-name").value = "";
      });
    </script>

  </body>

</html>